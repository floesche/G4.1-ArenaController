#+TITLE: PanelsController
#+AUTHOR: Peter Polidoro
#+EMAIL: peter@polidoro.io

* Library Information
- Name: PanelsController
- Description: Arduino library for communicating with the Reiser Lab Modular LED Display panels.
- Version: 0.1.0
- Release Date: 2023-08-16
- Creation Date: 2023-08-16
- License: BSD-3-Clause
- URL: https://github.com/janelia-arduino/PanelsController
- Author: Peter Polidoro
- Email: peter@polidoro.io
- Copyright: 2023 Howard Hughes Medical Institute
- References:
  - https://reiserlab.github.io/Modular-LED-Display/

* Layout

** Quarter Panel

message = LOW BYTE | HIGH BYTE
message[byte index] = pixel[column index][row index] | (pixel[column index][row index + 1] << 4)

|   | 0  | 1  | 2   | 3   | 4   | 5   | 6   | 7   |
| 7 | 4H | 8H | 12H | 16H | 20H | 24H | 28H | 33H |
| 6 | 4L | 8L | 12L | 16L | 20L | 24L | 28L | 33L |
| 5 | 3H | 7H | 11H | 15H | 19H | 23H | 27H | 32H |
| 4 | 3L | 7L | 11L | 15L | 19L | 23L | 27L | 31L |
| 3 | 2H | 6H | 10H | 14H | 18H | 22H | 26H | 30H |
| 2 | 2L | 6L | 10L | 14L | 18L | 22L | 26L | 30L |
| 1 | 1H | 5H | 9H  | 13H | 17H | 21H | 25H | 29H |
| 0 | 1L | 5L | 9L  | 13L | 17L | 21L | 25L | 29L |

** Panel

|   | 0               |               1 |
| 1 | Quarter Panel 1 | Quarter Panel 3 |
| 0 | Quarter Panel 0 | Quarter Panel 2 |

** Arena

|   | 0       | 1       | 2        | 3        | 4        | 5        |        6 |
| 5 | Panel 4 | Panel 9 | Panel 14 | Panel 19 | Panel 24 | Panel 29 | Panel 34 |
| 4 | Panel 3 | Panel 8 | Panel 13 | Panel 18 | Panel 23 | Panel 28 | Panel 33 |
| 3 | Panel 2 | Panel 7 | Panel 12 | Panel 17 | Panel 22 | Panel 27 | Panel 32 |
| 2 | Panel 1 | Panel 6 | Panel 11 | Panel 16 | Panel 21 | Panel 26 | Panel 31 |
| 1 | Panel 0 | Panel 5 | Panel 10 | Panel 15 | Panel 20 | Panel 25 | Panel 30 |

* Development

** PlatformIO

*** Install PlatformIO Core

[[https://docs.platformio.org/en/latest/core/installation/index.html]]

**** Example

#+BEGIN_SRC sh
sudo apt install -y python3-venv
mkdir -p ~/platformio/venv
python3 -m venv ~/platformio/venv
source ~/platformio/venv/bin/activate
pip install platformio
pio --version
#+END_SRC

**** 99-platformio-udev.rules

Linux users have to install udev rules for PlatformIO supported boards/devices.

***** Download udev rules file to /etc/udev/rules.d

#+BEGIN_SRC sh
curl -fsSL https://raw.githubusercontent.com/platformio/platformio-core/develop/platformio/assets/system/99-platformio-udev.rules | sudo tee /etc/udev/rules.d/99-platformio-udev.rules
#+END_SRC

***** Restart udev management tool

#+BEGIN_SRC sh
sudo service udev restart
#+END_SRC

***** Add user to groups

#+BEGIN_SRC sh
sudo usermod -a -G dialout $USER
sudo usermod -a -G plugdev $USER
#+END_SRC

***** Remove modemmanager

#+BEGIN_SRC sh
sudo apt-get purge --auto-remove modemmanager
#+END_SRC

*** Download this repository

[[https://github.com/janelia-arduino/PanelsController.git]]

**** Example

#+BEGIN_SRC sh
sudo apt install -y git
cd ~/platformio
git clone https://github.com/janelia-arduino/PanelsController.git
#+END_SRC

*** Compile the firmware

**** Example

#+BEGIN_SRC sh
cd ~/platformio/PanelsController
pio run -e teensy41
#+END_SRC

*** Upload the firmware

**** Example

#+BEGIN_SRC sh
cd ~/platformio/PanelsController
pio run -e teensy41 -t upload
#+END_SRC
